<script type="cerebral/cortex">
{
  "tracking": {
    "segment": {
      "enabled": <%- segment %>,
      "tracker": <%- segment ? JSON.stringify(ids.segment.ga) : '' %>
    },
    "ga": {
      "enabled": <%- !!(ga || multi) %>,
      "tracker": <%- JSON.stringify(ids.ga) %>
    }
  }
}
</script>

<script>
  <% if (segment) { %>
    // Use Segment.io if provided.
    var analytics=analytics||[];(function(){var e=["identify","track","trackLink","trackForm","trackClick","trackSubmit","page","pageview","ab","alias","ready","group"],t=function(e){return function(){analytics.push([e].concat(Array.prototype.slice.call(arguments,0)))}};for(var n=0;n<e.length;n++)analytics[e[n]]=t(e[n])})(),analytics.load=function(e){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src=("https:"===document.location.protocol?"https://":"http://")+"d2dq2ahtl5zl1z.cloudfront.net/analytics.js/v1/"+e+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n)};
    analytics.load(<%- JSON.stringify(ids.segment.key) %>);
  <% } else { %>
     // Use GA by default if there is no Segment.io.
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  <% } %>

  // Setup GA trackers to send events, wrap in callback if we are using segment.io
  <% if (multi) { %>analytics.ready(function ready() {<% } %>
    <% if (ga) { %>ga(function ready() {<% } %>
      <% ids.ga.forEach(function create(id) { var x = id.split('-') %>
        ga('create', '<%= id %>', { name: 'jitsu-<%= x[2] %>', cookieDomain: '<%= domain %>' });
        ga.getByName('jitsu-<%= x[2] %>').send('pageview');
      <% }) %>
    <% if (ga) { %>});<% } %>
  <% if (multi) { %>})<% } %>
</script>
